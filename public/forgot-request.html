<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Forgot Password</title>
  <link href="https://fonts.googleapis.com/css?family=Press+Start+2P" rel="stylesheet">
  <style>
    body { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f1419 100%); color: #fff; font-family: 'Press Start 2P', monospace, cursive; min-height: 100vh; margin: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; box-sizing: border-box; }
    
    .container { background: #181818; border-radius: 16px; box-shadow: 0 0 32px #0ff8, 0 0 8px #000a; padding: 40px 32px 32px 32px; margin-top: 40px; text-align: center; max-width: 450px; width: 100%; position: relative; overflow: hidden; animation: fadeInUp 1s ease-out; }
    
    .container::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, #0ff, #ff0, #f0f, #0ff); animation: glow 2s ease-in-out infinite alternate; }
    
    @keyframes glow { 0% { opacity: 0.5; } 100% { opacity: 1; } }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
    
    .icon { font-size: 48px; margin-bottom: 20px; animation: pulse 2s infinite; }
    
    h1 { font-size: 24px; margin: 20px 0 10px 0; text-shadow: 2px 2px #0ff, 0 0 16px #0ff8; letter-spacing: 2px; animation: fadeInUp 1s ease-out 0.2s both; }
    
    .subtitle { font-size: 12px; color: #aaa; margin-bottom: 25px; line-height: 1.4; animation: fadeInUp 1s ease-out 0.4s both; }
    
    .form-group { margin: 20px 0; text-align: left; animation: fadeInUp 1s ease-out 0.6s both; }
    .form-group label { display: block; font-size: 10px; color: #0ff; margin-bottom: 8px; letter-spacing: 1px; }
    
    input[type="email"] { font-family: inherit; font-size: 14px; padding: 12px 16px; margin: 8px 0; border-radius: 8px; border: 2px solid #0ff; background: #111; color: #fff; width: 100%; max-width: 300px; box-sizing: border-box; outline: none; transition: all 0.3s; }
    input[type="email"]:focus { border-color: #ff0; box-shadow: 0 0 8px #ff08; transform: translateY(-1px); }
    input[type="email"].error { border-color: #f44; box-shadow: 0 0 8px #f448; animation: shake 0.5s ease-in-out; }
    input[type="email"].success { border-color: #4f4; box-shadow: 0 0 8px #4f48; }
    
    button { font-family: inherit; font-size: 14px; padding: 12px 24px; margin: 16px 0; border-radius: 8px; border: 2px solid #0ff; background: linear-gradient(90deg, #0ff 0%, #00f 100%); color: #222; cursor: pointer; transition: all 0.3s; font-weight: bold; position: relative; overflow: hidden; width: 100%; max-width: 300px; }
    button:hover:not(:disabled) { background: linear-gradient(90deg, #ff0 0%, #f0f 100%); color: #111; transform: translateY(-2px); box-shadow: 0 4px 16px #0ff8; }
    button:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
    
    .loading-spinner { width: 16px; height: 16px; border: 2px solid transparent; border-top: 2px solid #222; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto; display: none; }
    
    .message { margin: 16px 0; padding: 12px; border-radius: 8px; font-size: 11px; line-height: 1.4; min-height: 20px; transition: all 0.3s; }
    .message.success { background: rgba(0, 255, 136, 0.1); border: 1px solid #4f4; color: #4f4; }
    .message.error { background: rgba(255, 68, 68, 0.1); border: 1px solid #f44; color: #f44; }
    .message.info { background: rgba(0, 255, 255, 0.1); border: 1px solid #0ff; color: #0ff; }
    .message.hidden { opacity: 0; transform: translateY(-10px); }
    
    .back-link { color: #0ff; font-size: 12px; text-decoration: none; margin-top: 20px; display: inline-block; transition: all 0.3s; padding: 8px 12px; border-radius: 6px; animation: fadeInUp 1s ease-out 0.8s both; }
    .back-link:hover { color: #ff0; text-decoration: underline; background: rgba(0, 255, 255, 0.1); transform: translateY(-2px); }
    
    .rate-limit-warning { font-size: 10px; color: #aaa; margin-top: 12px; animation: fadeInUp 1s ease-out 1s both; }
    
    @media (max-width: 768px) {
      body { padding: 10px; }
      .container { margin-top: 20px; padding: 24px 20px; }
      h1 { font-size: 20px; }
      .icon { font-size: 40px; }
      input[type="email"], button { font-size: 12px; padding: 10px 12px; }
    }
    
    @media (max-width: 480px) {
      h1 { font-size: 18px; letter-spacing: 1px; }
      .subtitle { font-size: 11px; }
      .icon { font-size: 32px; }
      input[type="email"], button { font-size: 11px; padding: 8px 10px; }
    }
  </style>
  <!-- ...existing code... -->
    </style>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=AW-11321000027"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'AW-11321000027');
    </script>

    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2953185987425903"
      crossorigin="anonymous"></script>
</head>
<!-- ...existing code... -->
</head>
<body>
  <div class="container">
    <div class="icon">üîë</div>
    <h1>üéÆ FORGOT PASSWORD</h1>
    <p class="subtitle">Don't worry! Enter your email address and we'll send you a link to reset your password.</p>
    
    <div class="form-group">
      <label for="resetEmail">Email Address</label>
      <input type="email" id="resetEmail" placeholder="your.email@example.com" required autocomplete="email">
    </div>
    
    <button id="sendResetBtn">
      <span id="buttonText">üöÄ Send Reset Link</span>
      <div id="buttonSpinner" class="loading-spinner"></div>
    </button>
    
    <div id="resetMsg" class="message hidden"></div>
    
    <div class="rate-limit-warning">
      For security, reset requests are limited to prevent abuse.
    </div>
    
    <a href="index.html" class="back-link">‚Üê Back to Login</a>
  </div>
  <script>
    let isProcessing = false;
    let rateLimitCount = 0;
    const maxAttempts = 3;
    const rateLimitWindow = 60000; // 1 minute
    
    // Auto-focus email input and handle Enter key
    document.addEventListener('DOMContentLoaded', function() {
      const emailInput = document.getElementById('resetEmail');
      emailInput.focus();
      
      emailInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter' && !isProcessing) {
          document.getElementById('sendResetBtn').click();
        }
      });
      
      // Real-time email validation
      emailInput.addEventListener('input', function() {
        const msg = document.getElementById('resetMsg');
        clearMessageClasses(emailInput, msg);
      });
      
      emailInput.addEventListener('blur', function() {
        validateEmail(this.value.trim(), true);
      });
    });
    
    function validateEmail(email, showFeedback = false) {
      const emailInput = document.getElementById('resetEmail');
      const msg = document.getElementById('resetMsg');
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      
      clearMessageClasses(emailInput, msg);
      
      if (!email) {
        if (showFeedback) {
          showMessage('Please enter your email address.', 'error');
          emailInput.classList.add('error');
        }
        return false;
      }
      
      if (!emailRegex.test(email)) {
        if (showFeedback) {
          showMessage('Please enter a valid email address.', 'error');
          emailInput.classList.add('error');
        }
        return false;
      }
      
      if (showFeedback) {
        emailInput.classList.add('success');
      }
      return true;
    }
    
    function showMessage(text, type) {
      const msg = document.getElementById('resetMsg');
      msg.textContent = text;
      msg.className = `message ${type}`;
    }
    
    function clearMessageClasses(emailInput, msg) {
      emailInput.classList.remove('error', 'success');
      msg.classList.add('hidden');
    }
    
    function showLoading() {
      isProcessing = true;
      const button = document.getElementById('sendResetBtn');
      const buttonText = document.getElementById('buttonText');
      const spinner = document.getElementById('buttonSpinner');
      
      button.disabled = true;
      buttonText.style.display = 'none';
      spinner.style.display = 'block';
    }
    
    function hideLoading() {
      isProcessing = false;
      const button = document.getElementById('sendResetBtn');
      const buttonText = document.getElementById('buttonText');
      const spinner = document.getElementById('buttonSpinner');
      
      button.disabled = false;
      buttonText.style.display = 'block';
      spinner.style.display = 'none';
    }
    
    function checkRateLimit() {
      if (rateLimitCount >= maxAttempts) {
        showMessage(`Too many attempts. Please wait before trying again.`, 'error');
        return false;
      }
      return true;
    }
    
    // When user clicks "Send Reset Link"
    document.getElementById('sendResetBtn').onclick = async function() {
      if (isProcessing) return;
      
      const email = document.getElementById('resetEmail').value.trim();
      const msg = document.getElementById('resetMsg');
      
      // Clear previous messages
      clearMessageClasses(document.getElementById('resetEmail'), msg);
      
      // Validate email
      if (!validateEmail(email, true)) {
        return;
      }
      
      // Check rate limiting
      if (!checkRateLimit()) {
        return;
      }
      
      showLoading();
      rateLimitCount++;
      
      try {
        const res = await fetch('/forgot-password', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email })
        });
        
        const data = await res.json();
        
        if (res.ok) {
          showMessage('‚úÖ If your email is registered, you will receive a reset link shortly. Please check your inbox and spam folder.', 'success');
          document.getElementById('resetEmail').classList.add('success');
          
          // Reset rate limit on success
          setTimeout(() => {
            rateLimitCount = Math.max(0, rateLimitCount - 1);
          }, rateLimitWindow);
        } else {
          throw new Error(data.message || 'Failed to send reset email');
        }
        
      } catch (error) {
        console.error('Password reset error:', error);
        
        if (error.name === 'TypeError') {
          showMessage('‚ùå Network error. Please check your connection and try again.', 'error');
        } else {
          showMessage('‚ùå ' + (error.message || 'An error occurred. Please try again later.'), 'error');
        }
        
        document.getElementById('resetEmail').classList.add('error');
      } finally {
        hideLoading();
      }
    };
    
    // Reset rate limiting after time window
    setInterval(() => {
      if (rateLimitCount > 0) {
        rateLimitCount--;
      }
    }, rateLimitWindow);
  </script>
</body>
</html>